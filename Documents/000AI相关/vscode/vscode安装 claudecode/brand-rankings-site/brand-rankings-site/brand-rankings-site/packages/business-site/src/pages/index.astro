---
// ç§‘æŠ€æ•°ç å­ç«™é¦–é¡µ
import BaseLayout from '../layouts/BaseLayout.astro';
import Breadcrumb from '../components/Breadcrumb.astro';
import { loadRankingsByIndustry, getIndustryById } from '../utils/dataLoader';
import { formatDate, formatNumber } from '../utils/helpers';

const industry = getIndustryById('business');
const rankings = loadRankingsByIndustry('business');

if (!industry) {
  return Astro.redirect('/404');
}

const breadcrumbItems = [
  { label: 'é¦–é¡µ', href: '/' },
  { label: industry.name }
];
---

<BaseLayout
  title={`${industry.name} - æ’è¡Œæ¦œåˆ—è¡¨`}
  description={industry.description}
>
  <!-- Header with Breadcrumb -->
  <header class="bg-white border-b border-neutral-200">
    <div class="container mx-auto px-4 py-4">
      <Breadcrumb items={breadcrumbItems} />

      <div class="flex items-center justify-between mt-2">
        <div class="flex items-center space-x-3">
          <span class="text-4xl">{industry.icon}</span>
          <div>
            <h1 class="text-2xl md:text-3xl font-display font-bold text-neutral-900">
              {industry.name}
            </h1>
            <p class="text-sm text-neutral-600 mt-1">
              {industry.description}
            </p>
          </div>
        </div>
        <a
          href="/"
          class="hidden md:block text-sm text-neutral-600 hover:text-primary-600 transition-colors"
        >
          â† è¿”å›ä¸»ç«™
        </a>
      </div>
    </div>
  </header>

  <div class="container mx-auto px-4 py-8 md:py-12">

    <!-- ç»Ÿè®¡ä¿¡æ¯ -->
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-12">
      <div class="bg-white border border-neutral-200 rounded-lg p-6 text-center">
        <div class="text-3xl font-display font-bold text-primary-600 mb-1">
          {rankings.length}
        </div>
        <div class="text-sm text-neutral-600">æ’è¡Œæ¦œæ€»æ•°</div>
      </div>

      <div class="bg-white border border-neutral-200 rounded-lg p-6 text-center">
        <div class="text-3xl font-display font-bold text-primary-600 mb-1">
          {rankings.reduce((sum, r) => sum + r.brands.length, 0)}
        </div>
        <div class="text-sm text-neutral-600">å“ç‰Œæ€»æ•°</div>
      </div>

      <div class="bg-white border border-neutral-200 rounded-lg p-6 text-center">
        <div class="text-3xl font-display font-bold text-primary-600 mb-1">
          {formatNumber(rankings.reduce((sum, r) => sum + (r.viewCount || 0), 0))}
        </div>
        <div class="text-sm text-neutral-600">æ€»æµè§ˆé‡</div>
      </div>

      <div class="bg-white border border-neutral-200 rounded-lg p-6 text-center">
        <div class="text-3xl font-display font-bold text-primary-600 mb-1">
          {new Date().toLocaleDateString('zh-CN', { month: 'short', day: 'numeric' })}
        </div>
        <div class="text-sm text-neutral-600">æœ€æ–°æ›´æ–°</div>
      </div>
    </div>

    <!-- æ’è¡Œæ¦œåˆ—è¡¨ -->
    <section>
      <div class="flex items-end justify-between mb-8">
        <div>
          <h2 class="text-2xl md:text-3xl font-display font-bold text-neutral-900 mb-2">
            æ‰€æœ‰æ’è¡Œæ¦œ
          </h2>
          <p class="text-base text-neutral-600">
            å…± {rankings.length} ä¸ªä¸“ä¸šæ’è¡Œæ¦œ
          </p>
        </div>
      </div>

      {rankings.length > 0 ? (
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {rankings.map((ranking) => (
            <a href={`/rankings/${ranking.slug}`} class="group block">
              <div class="bg-white border border-neutral-200 rounded-lg p-6 hover:shadow-card-hover hover:-translate-y-1 transition-all duration-250 h-full">

                <!-- è¡Œä¸šæ ‡ç­¾ -->
                <div class="flex items-center space-x-2 mb-4">
                  <span class={`w-2 h-2 rounded-full bg-industry-${ranking.category}`}></span>
                  <span class="text-xs text-neutral-500">
                    {formatDate(ranking.updateDate)}
                  </span>
                </div>

                <!-- æ ‡é¢˜ -->
                <h3 class="text-xl font-semibold text-neutral-900 mb-3 group-hover:text-primary-600 transition-colors line-clamp-2">
                  {ranking.title}
                </h3>

                <!-- æè¿° -->
                <p class="text-sm text-neutral-600 mb-4 line-clamp-2">
                  {ranking.description}
                </p>

                <!-- å…ƒæ•°æ® -->
                <div class="flex items-center justify-between text-sm">
                  <span class="text-neutral-500">
                    Top {ranking.brands.length} å“ç‰Œ
                  </span>
                  {ranking.viewCount && (
                    <span class="text-neutral-500">
                      {formatNumber(ranking.viewCount)} æµè§ˆ
                    </span>
                  )}
                </div>

                <!-- Top 3 é¢„è§ˆ -->
                {ranking.brands.length >= 3 && (
                  <div class="mt-4 pt-4 border-t border-neutral-200">
                    <div class="text-xs text-neutral-600 mb-2">å‰ä¸‰å:</div>
                    <div class="flex items-center -space-x-2">
                      {ranking.brands.slice(0, 3).map((brand) => (
                        <div class="w-8 h-8 bg-neutral-100 rounded-full border-2 border-white flex items-center justify-center overflow-hidden">
                          <img
                            src={brand.logo}
                            alt={brand.name}
                            class="w-full h-full object-contain p-1"
                            loading="lazy"
                          />
                        </div>
                      ))}
                      <span class="text-xs text-neutral-500 ml-3">
                        ç­‰{ranking.brands.length}ä¸ªå“ç‰Œ
                      </span>
                    </div>
                  </div>
                )}

              </div>
            </a>
          ))}
        </div>
      ) : (
        <div class="bg-gradient-to-r from-primary-50 to-accent-50 border border-primary-200 rounded-xl p-12 text-center">
          <div class="text-5xl mb-4">ğŸ“Š</div>
          <h3 class="text-2xl font-display font-bold text-neutral-900 mb-2">
            æ’è¡Œæ¦œå³å°†ä¸Šçº¿
          </h3>
          <p class="text-neutral-600 mb-6">
            æˆ‘ä»¬æ­£åœ¨ç²¾å¿ƒå‡†å¤‡{industry.name}è¡Œä¸šçš„æ’è¡Œæ¦œæ•°æ®
          </p>
          <a
            href="/"
            class="inline-block px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors font-medium"
          >
            è¿”å›é¦–é¡µ
          </a>
        </div>
      )}
    </section>

  </div>
</BaseLayout>
