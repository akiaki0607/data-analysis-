# 抖音联想词采集工具 V0.5 - 测试用例文档

## 测试概述

本文档基于需求文档（PRD）和技术执行文档（SOP），为抖音联想词自动化采集工具 V0.5 制定完整的测试用例，确保系统能够满足所有验收标准。

---

## 1. 环境准备测试用例

### TC001 - 系统环境检查
**测试目标**: 验证系统环境是否满足运行要求

**前置条件**: 
- 全新系统环境

**测试步骤**:
1. 检查 Python 版本 >= 3.8
2. 检查 pip 是否可用
3. 运行 `python3 test_setup.py` 验证项目结构

**预期结果**:
- Python 版本符合要求
- pip 正常工作
- 项目结构检查通过

**优先级**: P0

---

### TC002 - 依赖安装测试
**测试目标**: 验证依赖包能够正确安装

**前置条件**: 
- Python 环境正常
- 网络连接正常

**测试步骤**:
1. 运行 `pip install -r requirements.txt`
2. 运行 `python -m playwright install chromium`
3. （可选）安装 Tesseract OCR

**预期结果**:
- 所有依赖包安装成功
- Chromium 浏览器下载完成
- OCR 组件可用（如果安装）

**优先级**: P0

---

## 2. 输入数据测试用例

### TC003 - 输入文件格式验证
**测试目标**: 验证输入 CSV 文件格式正确性

**测试数据**: 
```csv
client,platform,keyword
思迈特,douyin,体检套餐
思迈特,douyin,糖尿病饮食
永洪,douyin,数据分析
```

**测试步骤**:
1. 创建符合格式的 CSV 文件
2. 验证包含必要字段：client, platform, keyword
3. 验证 platform 字段值为 "douyin"
4. 验证文件编码为 UTF-8

**预期结果**:
- CSV 文件格式正确
- 包含所有必要字段
- 平台字段值正确
- 编码格式正确

**优先级**: P0

---

### TC004 - 输入数据边界测试
**测试目标**: 验证不同数量关键词的处理能力

**测试场景**:
- 最小数据集：2个客户 × 1个关键词
- 标准数据集：2个客户 × 10个关键词
- 大数据集：5个客户 × 50个关键词

**测试步骤**:
1. 分别准备不同规模的测试数据
2. 运行采集程序
3. 检查处理结果

**预期结果**:
- 各种规模数据均能正常处理
- 程序稳定运行不崩溃

**优先级**: P1

---

## 3. 核心功能测试用例

### TC005 - 基本采集功能测试
**测试目标**: 验证基本的联想词采集功能

**前置条件**: 
- 系统环境正常
- 输入数据准备完毕

**测试步骤**:
1. 运行命令：`python src/main.py --input data/input/keywords.csv --outdir data/output --shots screenshots --headful`
2. 观察浏览器自动操作过程
3. 等待程序执行完成

**预期结果**:
- 浏览器成功打开并导航到抖音
- 能够输入关键词并触发联想词
- 程序正常完成执行

**优先级**: P0

---

### TC006 - DOM 提取功能测试
**测试目标**: 验证 DOM 方式提取联想词的准确性

**测试数据**: 
- 关键词：健康管理、数据分析

**测试步骤**:
1. 使用 --headful 模式运行程序
2. 观察联想词提取过程
3. 检查输出结果中 source_mode 字段

**预期结果**:
- source_mode 显示为 "DOM"
- 提取的联想词文本准确
- 至少提取到 1 条联想词

**优先级**: P0

---

### TC007 - OCR 兜底功能测试
**测试目标**: 验证 OCR 兜底机制的有效性

**前置条件**: 
- Tesseract OCR 已安装
- DOM 提取失败的场景

**测试步骤**:
1. 模拟 DOM 选择器失效的情况
2. 运行采集程序
3. 检查是否触发 OCR 提取

**预期结果**:
- 程序能够自动切换到 OCR 模式
- source_mode 显示为 "OCR"
- 能够从截图中识别出联想词文本

**优先级**: P1

---

### TC008 - 截图功能测试
**测试目标**: 验证截图功能的完整性

**测试步骤**:
1. 运行采集程序
2. 检查截图文件生成情况
3. 验证截图内容和质量

**预期结果**:
- 每个关键词都生成对应截图
- 截图文件路径格式正确：`screenshots/当日/客户/平台/关键词_时间戳.png`
- 截图内容清晰可见联想词

**优先级**: P0

---

## 4. 输出结果测试用例

### TC009 - CSV 输出格式测试
**测试目标**: 验证输出 CSV 文件格式符合数据字典

**测试步骤**:
1. 运行完整采集流程
2. 检查输出 CSV 文件
3. 验证所有必要字段

**预期结果**:
CSV 包含以下字段且格式正确：
- date：采集日期（YYYY-MM-DD）
- client：客户名
- platform：固定 douyin
- keyword：输入的关键词
- rank：联想词顺序（从 1 开始）
- suggestion_text：联想词文本
- page_url：页面 URL
- screenshot_path：截图相对路径
- source_mode：DOM / OCR / NONE

**优先级**: P0

---

### TC010 - 文件路径结构测试
**测试目标**: 验证输出文件路径结构正确

**测试步骤**:
1. 运行采集程序
2. 检查输出目录结构

**预期结果**:
- CSV 文件路径：`data/output/当日/客户_平台.csv`
- 截图文件路径：`screenshots/当日/客户/平台/关键词_时间戳.png`
- 日期格式为 YYYY-MM-DD

**优先级**: P0

---

## 5. 异常处理测试用例

### TC011 - 重试机制测试
**测试目标**: 验证异常情况下的重试机制

**测试场景**:
- 网络连接不稳定
- 页面加载超时
- 联想词提取失败

**测试步骤**:
1. 创建网络不稳定的测试环境
2. 运行采集程序
3. 观察重试行为

**预期结果**:
- 最多重试 2 次
- 重试间隔符合配置
- 失败后记录到日志

**优先级**: P1

---

### TC012 - 验证码处理测试
**测试目标**: 验证遇到验证码时的处理能力

**前置条件**: 
- 使用 --headful 模式

**测试步骤**:
1. 触发抖音验证码机制
2. 手动完成验证码
3. 观察程序是否继续执行

**预期结果**:
- 程序暂停等待用户操作
- 验证码完成后程序继续
- 不影响后续关键词处理

**优先级**: P2

---

### TC013 - 异常关键词处理测试
**测试目标**: 验证特殊字符关键词的处理

**测试数据**: 
- 包含特殊字符的关键词：`C++编程`、`AI/ML`、`数据@分析`

**测试步骤**:
1. 准备包含特殊字符的关键词
2. 运行采集程序
3. 检查文件名净化效果

**预期结果**:
- 特殊字符被正确净化
- 文件能够正常创建
- 不影响数据内容准确性

**优先级**: P1

---

## 6. 性能测试用例

### TC014 - 执行效率测试
**测试目标**: 验证程序执行效率

**测试数据**: 
- 2个客户 × 10个关键词

**测试步骤**:
1. 记录程序开始时间
2. 运行完整采集流程
3. 记录程序结束时间

**预期结果**:
- 单个关键词处理时间 < 30秒
- 总体执行时间合理
- 内存使用稳定

**优先级**: P2

---

### TC015 - 资源占用测试
**测试目标**: 验证程序资源占用情况

**测试步骤**:
1. 监控程序运行期间的资源使用
2. 检查内存泄漏情况
3. 验证浏览器进程正确关闭

**预期结果**:
- 内存使用合理且稳定
- 无明显内存泄漏
- 程序结束后资源正确释放

**优先级**: P2

---

## 7. 兼容性测试用例

### TC016 - 操作系统兼容性测试
**测试目标**: 验证跨平台兼容性

**测试环境**:
- Windows 10/11
- macOS 10.14+
- Ubuntu 18.04+

**测试步骤**:
1. 在各平台分别部署程序
2. 运行标准测试用例
3. 检查功能一致性

**预期结果**:
- 所有平台功能正常
- 输出结果格式一致
- 路径分隔符正确处理

**优先级**: P1

---

### TC017 - 一键脚本测试
**测试目标**: 验证一键运行脚本的可用性

**测试步骤**:
1. Windows：双击 `run.bat`
2. macOS/Linux：运行 `./run.sh`
3. 观察自动化安装和执行过程

**预期结果**:
- 依赖自动安装成功
- 程序自动开始执行
- 无需手动干预

**优先级**: P0

---

## 8. 验收测试用例

### TC018 - 完整验收流程测试
**测试目标**: 验证所有验收标准的达成

**验收标准检查**:
1. ≥2 个客户、每个≥10 个关键词顺利跑完
2. 每个关键词产出至少 1 条联想词文本
3. 每个关键词产出至少 1 张截图
4. 输出字段完整且 UTF-8 编码
5. 异常关键词重试 ≤2 次，失败记录在日志
6. 不修改代码，通过 CSV + 脚本即可运行

**测试步骤**:
1. 准备标准测试数据（2客户 × 10关键词）
2. 使用一键脚本运行
3. 逐项检查验收标准

**预期结果**:
- 所有验收标准均满足
- 程序稳定可靠运行

**优先级**: P0

---

## 9. 质量校验测试用例

### TC019 - 数据质量校验测试
**测试目标**: 验证输出数据的质量

**测试步骤**:
1. 随机抽取 10 条结果记录
2. 对比联想词文本与截图内容
3. 检查数据一致性

**预期结果**:
- 联想词文本与截图内容一致
- 无明显的识别错误
- 数据完整性良好

**优先级**: P1

---

### TC020 - 异常数据检测测试
**测试目标**: 验证异常数据的识别能力

**检查项目**:
1. 单关键词联想词条数为 0 或过少
2. source_mode=OCR 占比 > 50%
3. 截图文件缺失或损坏

**测试步骤**:
1. 运行大批量数据采集
2. 统计各项指标
3. 分析异常原因

**预期结果**:
- 能够识别异常数据模式
- 提供合理的异常分析
- 日志记录详细的错误信息

**优先级**: P1

---

## 10. 回归测试用例

### TC021 - 配置文件修改测试
**测试目标**: 验证配置文件修改后的功能稳定性

**测试步骤**:
1. 修改 `config/config.yml` 中的选择器
2. 调整超时时间配置
3. 运行采集程序验证效果

**预期结果**:
- 配置修改生效
- 程序功能正常
- 无需修改代码

**优先级**: P1

---

### TC022 - 长期稳定性测试
**测试目标**: 验证程序长期运行的稳定性

**测试步骤**:
1. 准备大量测试数据（100+ 关键词）
2. 连续运行多次采集任务
3. 监控程序稳定性

**预期结果**:
- 程序长期稳定运行
- 无内存泄漏或资源耗尽
- 错误率保持在可接受范围

**优先级**: P2

---

## 测试执行计划

### 阶段一：基础功能测试（P0 优先级）
- TC001, TC002, TC003, TC005, TC006, TC008, TC009, TC010, TC017, TC018

### 阶段二：异常处理测试（P1 优先级）
- TC004, TC007, TC011, TC013, TC016, TC019, TC020, TC021

### 阶段三：性能优化测试（P2 优先级）
- TC012, TC014, TC015, TC022

## 测试环境要求

- **硬件**: 至少 4GB 内存，2GB 可用磁盘空间
- **软件**: Python 3.8+, 网络连接
- **浏览器**: Chromium（自动下载）
- **可选**: Tesseract OCR

## 测试数据管理

所有测试用例使用统一的测试数据集，包括：
- 标准关键词（健康、科技、教育类）
- 特殊字符关键词
- 长短不一的关键词
- 多语言关键词（中英混合）

## 缺陷分级标准

- **P0**: 阻塞性缺陷，影响基本功能
- **P1**: 严重缺陷，影响主要功能
- **P2**: 一般缺陷，影响辅助功能
- **P3**: 轻微缺陷，不影响使用

---

**测试文档版本**: V1.0  
**创建日期**: 2025-10-19  
**适用版本**: 抖音联想词采集工具 V0.5