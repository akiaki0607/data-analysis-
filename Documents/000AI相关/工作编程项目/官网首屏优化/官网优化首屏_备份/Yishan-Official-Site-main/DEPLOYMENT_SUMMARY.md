# éƒ¨ç½²æ–‡ä»¶æ¸…å•å’Œä½¿ç”¨è¯´æ˜

> æœ¬æ–‡æ¡£æ±‡æ€»äº†æ‰€æœ‰æ–°å¢çš„éƒ¨ç½²ç›¸å…³æ–‡ä»¶ï¼Œä¾¿äºå¿«é€ŸæŸ¥æ‰¾å’Œä½¿ç”¨

---

## ğŸ“‚ æ–°å¢æ–‡ä»¶æ¸…å•

### ğŸ“– æ–‡æ¡£ç±»

| æ–‡ä»¶ | è¯´æ˜ | é€‚åˆäººç¾¤ |
|------|------|---------|
| **DEPLOYMENT_GUIDE.md** | è¶…è¯¦ç»†çš„ Git éƒ¨ç½²æ•™ç¨‹ï¼ˆ3000+ å­—ï¼‰ | é›¶åŸºç¡€å¼€å‘è€… |
| **QUICK_START.md** | ä¸€é¡µçº¸å¿«é€Ÿå¼€å§‹æŒ‡å— | æœ‰ç»éªŒçš„å¼€å‘è€… |
| **env.example** | ç¯å¢ƒå˜é‡é…ç½®æ¨¡æ¿å’Œè¯¦ç»†è¯´æ˜ | æ‰€æœ‰å¼€å‘è€… |
| **DEPLOYMENT_SUMMARY.md** | æœ¬æ–‡ä»¶ï¼Œéƒ¨ç½²æ–‡ä»¶æ¸…å• | å¿«é€ŸæŸ¥æ‰¾ |

### ğŸ”§ è„šæœ¬ç±»

| æ–‡ä»¶ | è¯´æ˜ | ä½¿ç”¨åœºæ™¯ |
|------|------|---------|
| **scripts/setup-git-deploy.sh** | é¦–æ¬¡éƒ¨ç½²è‡ªåŠ¨åŒ–è„šæœ¬ | é¦–æ¬¡åœ¨æœåŠ¡å™¨ä¸Šéƒ¨ç½²é¡¹ç›® |
| **scripts/deploy-update.sh** | æ—¥å¸¸æ›´æ–°ä¸€é”®è„šæœ¬ | æ¯æ¬¡ä»£ç æ›´æ–°åæ‰§è¡Œ |
| **scripts/rollback.sh** | ç´§æ€¥å›æ»šè„šæœ¬ | æ›´æ–°å‡ºç°é—®é¢˜æ—¶å¿«é€Ÿå›æ»š |

### âš™ï¸ é…ç½®ç±»

| æ–‡ä»¶ | è¯´æ˜ | ä½¿ç”¨åœºæ™¯ |
|------|------|---------|
| **ecosystem.config.js** | PM2 è¿›ç¨‹ç®¡ç†é…ç½®ï¼ˆå·²æ›´æ–°ï¼‰ | PM2 å¯åŠ¨å’Œç®¡ç†æœåŠ¡ |
| **nginx/geokeji.conf** | Nginx åå‘ä»£ç†é…ç½®ç¤ºä¾‹ | é…ç½®åŸŸåå’Œ HTTPS |

### ğŸ“¦ package.json æ–°å¢å‘½ä»¤

| å‘½ä»¤ | è¯´æ˜ |
|------|------|
| `npm run deploy:setup` | é¦–æ¬¡éƒ¨ç½² |
| `npm run deploy:update` | æ—¥å¸¸æ›´æ–° |
| `npm run deploy:rollback` | ç´§æ€¥å›æ»š |
| `npm run pm2:start` | å¯åŠ¨ PM2 æœåŠ¡ |
| `npm run pm2:stop` | åœæ­¢ PM2 æœåŠ¡ |
| `npm run pm2:restart` | é‡å¯ PM2 æœåŠ¡ |
| `npm run pm2:logs` | æŸ¥çœ‹æ—¥å¿— |
| `npm run pm2:status` | æŸ¥çœ‹çŠ¶æ€ |

---

## ğŸš€ å¿«é€Ÿå¼€å§‹ï¼ˆæœåŠ¡å™¨ç«¯ï¼‰

### é¦–æ¬¡éƒ¨ç½²ï¼ˆå®Œæ•´æµç¨‹ï¼‰

```bash
# 1. é…ç½® Git SSHï¼ˆé¦–æ¬¡é…ç½®ä¸€æ¬¡å³å¯ï¼‰
ssh-keygen -t rsa -b 4096 -C "your_email@example.com"
cat ~/.ssh/id_rsa.pub  # å¤åˆ¶å…¬é’¥åˆ° GitHub Settings â†’ SSH Keys
ssh -T git@github.com  # éªŒè¯è¿æ¥

# 2. å…‹éš†é¡¹ç›®
cd /www/server
git clone git@github.com:ä½ çš„ç”¨æˆ·å/Yishan-Official-Site.git geokeji
cd geokeji

# 3. é…ç½®ç¯å¢ƒå˜é‡
cp env.example .env.local
nano .env.local  # ä¿®æ”¹ä¸ºçœŸå®ä¿¡æ¯

# 4. ä¸€é”®éƒ¨ç½²
bash scripts/setup-git-deploy.sh

# 5. é…ç½® Nginx
sudo cp nginx/geokeji.conf /etc/nginx/sites-available/geokeji
sudo nano /etc/nginx/sites-available/geokeji  # ä¿®æ”¹åŸŸå
sudo ln -s /etc/nginx/sites-available/geokeji /etc/nginx/sites-enabled/
sudo nginx -t && sudo nginx -s reload
```

### æ—¥å¸¸æ›´æ–°ï¼ˆ2 æ¡å‘½ä»¤ï¼‰

```bash
# åœ¨æœ¬åœ° Windowsï¼ˆGit Bash æˆ– PowerShellï¼‰
git push

# åœ¨æœåŠ¡å™¨
cd /www/server/geokeji
bash scripts/deploy-update.sh
```

---

## ğŸ“‹ éƒ¨ç½²æ£€æŸ¥æ¸…å•

é¦–æ¬¡éƒ¨ç½²å®Œæˆåï¼Œé€é¡¹ç¡®è®¤ï¼š

- [ ] âœ… Git SSH é…ç½®æˆåŠŸï¼ˆ`ssh -T git@github.com`ï¼‰
- [ ] âœ… é¡¹ç›®å…‹éš†æˆåŠŸï¼ˆ`ls -la /www/server/geokeji`ï¼‰
- [ ] âœ… ç¯å¢ƒå˜é‡é…ç½®å®Œæˆï¼ˆ`.env.local` æ–‡ä»¶å­˜åœ¨ä¸”å†…å®¹æ­£ç¡®ï¼‰
- [ ] âœ… PM2 æœåŠ¡è¿è¡Œä¸­ï¼ˆ`pm2 list` æ˜¾ç¤º onlineï¼‰
- [ ] âœ… Nginx é…ç½®æ­£ç¡®ï¼ˆ`sudo nginx -t` é€šè¿‡ï¼‰
- [ ] âœ… ç½‘ç«™å¯è®¿é—®ï¼ˆæµè§ˆå™¨æ‰“å¼€åŸŸåæˆ– IP:5280ï¼‰
- [ ] âœ… è”ç³»è¡¨å•èƒ½å‘é€ï¼ˆæµ‹è¯•ä¸€æ¬¡ï¼‰
- [ ] âœ… åšå®¢æ–‡ç« èƒ½æ­£å¸¸æ˜¾ç¤º
- [ ] âœ… æ¡ˆä¾‹é¡µé¢èƒ½æ­£å¸¸è®¿é—®
- [ ] âœ… PM2 å¼€æœºè‡ªå¯åŠ¨å·²è®¾ç½®ï¼ˆ`pm2 startup && pm2 save`ï¼‰

---

## ğŸ” å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥

### PM2 ç®¡ç†

```bash
pm2 list                    # æŸ¥çœ‹æ‰€æœ‰æœåŠ¡
pm2 logs yishan-official             # æŸ¥çœ‹å®æ—¶æ—¥å¿—
pm2 logs yishan-official --lines 100 # æŸ¥çœ‹æœ€è¿‘ 100 è¡Œ
pm2 restart yishan-official          # é‡å¯æœåŠ¡
pm2 stop yishan-official             # åœæ­¢æœåŠ¡
pm2 delete yishan-official           # åˆ é™¤æœåŠ¡
pm2 monit                   # å®æ—¶ç›‘æ§ï¼ˆCPU/å†…å­˜ï¼‰
pm2 save                    # ä¿å­˜å½“å‰è¿›ç¨‹åˆ—è¡¨
pm2 startup                 # è®¾ç½®å¼€æœºè‡ªå¯
```

### Nginx ç®¡ç†

```bash
sudo nginx -t                    # æµ‹è¯•é…ç½®
sudo nginx -s reload             # é‡è½½é…ç½®ï¼ˆä¸åœæœºï¼‰
sudo systemctl restart nginx     # é‡å¯ Nginx
sudo systemctl status nginx      # æŸ¥çœ‹ Nginx çŠ¶æ€
sudo tail -f /var/log/nginx/error.log  # æŸ¥çœ‹é”™è¯¯æ—¥å¿—
```

### Git ç®¡ç†

```bash
git status              # æŸ¥çœ‹çŠ¶æ€
git pull origin main    # æ‹‰å–ä»£ç 
git log --oneline -10   # æŸ¥çœ‹å†å²
git reset --hard HEAD~1 # å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬
```

---

## ğŸ› æ•…éšœæ’æŸ¥å¿«é€Ÿç´¢å¼•

| é—®é¢˜ | æ£€æŸ¥å‘½ä»¤ | è§£å†³æ–¹æ¡ˆæ–‡æ¡£ |
|------|---------|------------|
| PM2 å¯åŠ¨å¤±è´¥ | `pm2 logs yishan-official --lines 100` | DEPLOYMENT_GUIDE.md ç¬¬å…­éƒ¨åˆ† é—®é¢˜3 |
| Nginx 502 é”™è¯¯ | `sudo tail -f /var/log/nginx/error.log` | DEPLOYMENT_GUIDE.md ç¬¬å…­éƒ¨åˆ† é—®é¢˜4 |
| ç«¯å£ 5280 è¢«å ç”¨ | `lsof -i:5280` | DEPLOYMENT_GUIDE.md ç¬¬å…­éƒ¨åˆ† é—®é¢˜3 |
| Git pull å¤±è´¥ï¼ˆå†²çªï¼‰ | `git status` | DEPLOYMENT_GUIDE.md ç¬¬å…­éƒ¨åˆ† é—®é¢˜1 |
| æ„å»ºå¤±è´¥ | `npm run build` | DEPLOYMENT_GUIDE.md ç¬¬å…­éƒ¨åˆ† é—®é¢˜2 |
| ç½‘ç«™æ‰“ä¸å¼€ | `pm2 list` å’Œ `sudo nginx -t` | DEPLOYMENT_GUIDE.md ç¬¬å…­éƒ¨åˆ† é—®é¢˜5 |

---

## ğŸ“š æ–‡æ¡£å¯¼èˆª

### æŒ‰ä½¿ç”¨åœºæ™¯æŸ¥æ‰¾

**ç¬¬ä¸€æ¬¡éƒ¨ç½²**ï¼š
1. é˜…è¯» [DEPLOYMENT_GUIDE.md](./DEPLOYMENT_GUIDE.md) ç¬¬ä¸€éƒ¨åˆ†ï¼ˆGit SSH é…ç½®ï¼‰
2. é˜…è¯» [DEPLOYMENT_GUIDE.md](./DEPLOYMENT_GUIDE.md) ç¬¬äºŒéƒ¨åˆ†ï¼ˆé¦–æ¬¡éƒ¨ç½²æµç¨‹ï¼‰
3. å‚è€ƒ [env.example](./env.example) é…ç½®ç¯å¢ƒå˜é‡

**æ—¥å¸¸æ›´æ–°**ï¼š
- æŸ¥çœ‹ [QUICK_START.md](./QUICK_START.md) æ—¥å¸¸æ›´æ–°ç« èŠ‚
- æˆ– [DEPLOYMENT_GUIDE.md](./DEPLOYMENT_GUIDE.md) ç¬¬ä¸‰éƒ¨åˆ†

**é‡åˆ°é—®é¢˜**ï¼š
- æŸ¥çœ‹ [DEPLOYMENT_GUIDE.md](./DEPLOYMENT_GUIDE.md) ç¬¬å…­éƒ¨åˆ†ï¼ˆå¸¸è§é—®é¢˜æ’æŸ¥ï¼‰
- æŸ¥çœ‹ [QUICK_START.md](./QUICK_START.md) æ•…éšœæ’æŸ¥è¡¨

**å¿«é€ŸæŸ¥å‘½ä»¤**ï¼š
- æŸ¥çœ‹ [QUICK_START.md](./QUICK_START.md) å¸¸ç”¨å‘½ä»¤ç« èŠ‚

---

## ğŸ¯ éƒ¨ç½²æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é¦–æ¬¡éƒ¨ç½²æµç¨‹                                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  [1] é…ç½® Git SSH                                             â”‚
â”‚       â†“                                                       â”‚
â”‚  [2] å…‹éš†é¡¹ç›®åˆ°æœåŠ¡å™¨                                           â”‚
â”‚       â†“                                                       â”‚
â”‚  [3] é…ç½®ç¯å¢ƒå˜é‡ï¼ˆ.env.localï¼‰                                â”‚
â”‚       â†“                                                       â”‚
â”‚  [4] æ‰§è¡Œ setup-git-deploy.sh                                â”‚
â”‚       â”œâ”€ å®‰è£…ä¾èµ– (npm install)                                â”‚
â”‚       â”œâ”€ æ„å»ºé¡¹ç›® (npm run build)                              â”‚
â”‚       â””â”€ å¯åŠ¨ PM2 æœåŠ¡                                         â”‚
â”‚       â†“                                                       â”‚
â”‚  [5] é…ç½® Nginx åå‘ä»£ç†                                       â”‚
â”‚       â†“                                                       â”‚
â”‚  [6] è®¿é—®ç½‘ç«™éªŒè¯                                              â”‚
â”‚       â†“                                                       â”‚
â”‚  âœ… éƒ¨ç½²å®Œæˆï¼                                                 â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ—¥å¸¸æ›´æ–°æµç¨‹                                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  [æœ¬åœ°] git push                                              â”‚
â”‚       â†“                                                       â”‚
â”‚  [æœåŠ¡å™¨] bash scripts/deploy-update.sh                       â”‚
â”‚       â”œâ”€ git pull æ‹‰å–æœ€æ–°ä»£ç                                  â”‚
â”‚       â”œâ”€ npm installï¼ˆå¦‚æœ package.json å˜åŒ–ï¼‰                 â”‚
â”‚       â”œâ”€ npm run build é‡æ–°æ„å»º                                â”‚
â”‚       â””â”€ pm2 restart yishan-official é‡å¯æœåŠ¡                  â”‚
â”‚       â†“                                                       â”‚
â”‚  âœ… æ›´æ–°å®Œæˆï¼                                                 â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’¡ æœ€ä½³å®è·µ

### éƒ¨ç½²å‰

1. âœ… æœ¬åœ°æµ‹è¯•é€šè¿‡ï¼ˆ`npm run build` æˆåŠŸï¼‰
2. âœ… æäº¤ä»£ç åˆ° GitHubï¼ˆ`git push`ï¼‰
3. âœ… ç¡®è®¤ç¯å¢ƒå˜é‡å·²é…ç½®

### éƒ¨ç½²æ—¶

1. âœ… ä½¿ç”¨ `deploy-update.sh` è„šæœ¬ï¼ˆè‡ªåŠ¨åŒ–ï¼‰
2. âœ… æŸ¥çœ‹æ—¥å¿—ç¡®è®¤æ— é”™è¯¯ï¼ˆ`pm2 logs yishan-official`ï¼‰
3. âœ… æµè§ˆå™¨æµ‹è¯•å…³é”®åŠŸèƒ½

### éƒ¨ç½²å

1. âœ… æ£€æŸ¥ç½‘ç«™æ˜¯å¦æ­£å¸¸è®¿é—®
2. âœ… æµ‹è¯•è”ç³»è¡¨å•
3. âœ… æ£€æŸ¥ PM2 çŠ¶æ€ï¼ˆ`pm2 list`ï¼‰
4. âœ… å¦‚æœ‰é—®é¢˜ç«‹å³å›æ»šï¼ˆ`bash scripts/rollback.sh`ï¼‰

---

## ğŸ†˜ è·å–å¸®åŠ©

å¦‚æœé‡åˆ°é—®é¢˜ï¼š

1. **æŸ¥çœ‹æ—¥å¿—**ï¼š`pm2 logs yishan-official`
2. **æŸ¥çœ‹ Nginx æ—¥å¿—**ï¼š`sudo tail -f /var/log/nginx/error.log`
3. **æ£€æŸ¥æœåŠ¡çŠ¶æ€**ï¼š`pm2 monit`
4. **å‚è€ƒæ–‡æ¡£**ï¼š
   - [DEPLOYMENT_GUIDE.md](./DEPLOYMENT_GUIDE.md) ç¬¬å…­éƒ¨åˆ† - å¸¸è§é—®é¢˜æ’æŸ¥
   - [QUICK_START.md](./QUICK_START.md) æ•…éšœæ’æŸ¥è¡¨

---

**æœ€åæ›´æ–°**ï¼š2025-10-15  
**ç»´æŠ¤è€…**ï¼šç§»å±±ç§‘æŠ€  
**ç‰ˆæœ¬**ï¼šv1.0

