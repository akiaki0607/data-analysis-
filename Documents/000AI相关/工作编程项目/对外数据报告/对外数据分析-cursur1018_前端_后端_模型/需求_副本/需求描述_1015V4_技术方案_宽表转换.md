# AIå¹³å°æ•°æ®åˆ†ææŠ¥å‘Š - æŠ€æœ¯æ–¹æ¡ˆ V4.0
## å®½è¡¨è½¬é•¿è¡¨æ™ºèƒ½è½¬æ¢æ–¹æ¡ˆ

---

## ğŸ“‹ æ–‡æ¡£ä¿¡æ¯

- **ç‰ˆæœ¬**: V4.0
- **æ—¥æœŸ**: 2024-10-19
- **åŸºäº**: éœ€æ±‚æè¿°_1015V3_å¢åŠ åç«¯.md
- **æ–°å¢ç‰¹æ€§**: å®½è¡¨æ ¼å¼æ™ºèƒ½è¯†åˆ«ä¸è½¬æ¢

---

## ğŸ¯ æ ¸å¿ƒå˜æ›´

### V4.0 ç›¸è¾ƒ V3.1 çš„ä¸»è¦å˜åŒ–

1. **æ–°å¢å®½è¡¨è½¬æ¢èƒ½åŠ›**
   - LLMæ™ºèƒ½è¯†åˆ«å®½è¡¨æ ¼å¼ï¼ˆå¤šå“ç‰Œåˆ—é‡å¤ï¼‰
   - è‡ªåŠ¨è½¬æ¢ä¸ºé•¿è¡¨æ ¼å¼
   - å‰ç«¯å±•ç¤ºè½¬æ¢é¢„è§ˆä¾›ç”¨æˆ·æ ¸å¯¹

2. **ä¼˜åŒ–æ•°æ®å¤„ç†æµç¨‹**
   - å®½è¡¨ â†’ é•¿è¡¨ â†’ æ ‡å‡†åŒ–å¤„ç†
   - ç¡®ä¿å…³é”®è¯æ•°æ®æ­£ç¡®è§£æ
   - æ”¯æŒå¤æ‚çš„å¤šå“ç‰Œå¤šæŒ‡æ ‡ç»“æ„

3. **å¢å¼ºç”¨æˆ·ä½“éªŒ**
   - æ•°æ®è½¬æ¢è¿‡ç¨‹å¯è§†åŒ–
   - è½¬æ¢ç»“æœå¯ä¸‹è½½
   - é”™è¯¯æç¤ºæ›´å‹å¥½

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### 1. æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     å‰ç«¯å±‚                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚æ–‡ä»¶ä¸Šä¼  â”‚  â”‚æ•°æ®é¢„è§ˆ  â”‚  â”‚  åˆ†æå±•ç¤º   â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚           â”‚                â”‚
        â†“           â†“                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   API å±‚ (Flask)                     â”‚
â”‚  /api/analyze  /api/preview  /api/demo-data        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ğŸ¤– LLMæ™ºèƒ½å±‚ (LLMAnalyzer)             â”‚
â”‚  - è¯†åˆ«Excelç»“æ„ï¼ˆmetadata/table/wide_tableï¼‰       â”‚
â”‚  - è¯†åˆ«å“ç‰Œåˆ—å—ä¸æŒ‡æ ‡æ˜ å°„                           â”‚
â”‚  - ç”Ÿæˆæ ‡å‡†åŒ–Schema                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          ğŸ æ•°æ®å¤„ç†å±‚ (DataProcessor)              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ 1. å®½è¡¨è¯†åˆ«ä¸è½¬æ¢                     â”‚          â”‚
â”‚  â”‚    - æ£€æµ‹wide_tableç±»å‹               â”‚          â”‚
â”‚  â”‚    - æ‰§è¡Œå®½â†’é•¿è½¬æ¢                    â”‚          â”‚
â”‚  â”‚    - ç”Ÿæˆè½¬æ¢é¢„è§ˆ                     â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ 2. æ ‡å‡†åŒ–æ•°æ®æå–                     â”‚          â”‚
â”‚  â”‚    - å…ƒæ•°æ®æå–                       â”‚          â”‚
â”‚  â”‚    - å“ç‰ŒæŒ‡æ ‡èšåˆ                     â”‚          â”‚
â”‚  â”‚    - å¹³å°æŒ‡æ ‡è®¡ç®—                     â”‚          â”‚
â”‚  â”‚    - å…³é”®è¯æ’åçŸ©é˜µ                   â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  æ•°æ®å­˜å‚¨å±‚                          â”‚
â”‚  - Excelä¸´æ—¶æ–‡ä»¶                                     â”‚
â”‚  - è½¬æ¢åçš„é•¿è¡¨æ•°æ®                                  â”‚
â”‚  - åˆ†æç»“æœç¼“å­˜                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š æ•°æ®å¤„ç†æµç¨‹

### 2.1 å®Œæ•´æ•°æ®æµ

```
ç”¨æˆ·ä¸Šä¼ Excel
    â†“
â‘  LLMè¯†åˆ«Sheetç»“æ„
    â”œâ”€ æ•°æ®å°é¢ â†’ metadata
    â”œâ”€ å“ç‰Œæ ¸å¿ƒæŒ‡æ ‡ â†’ table
    â”œâ”€ AIå¹³å°æ ¸å¿ƒæŒ‡æ ‡ â†’ table
    â””â”€ å…³é”®è¯æ•°æ®åˆ†æ â†’ wide_table âš¡
        â†“
â‘¡ æ£€æµ‹åˆ°wide_tableç±»å‹
    â†“
â‘¢ LLMè¯†åˆ«å“ç‰Œåˆ—å—ç»“æ„
    - è¯†åˆ«å“ç‰Œåç§°ï¼ˆç§»å±±ç§‘æŠ€ã€æ€è¿ˆç‰¹ç­‰ï¼‰
    - è¯†åˆ«å“ç‰Œç±»å‹ï¼ˆå®¢æˆ·ã€æ ¸å¿ƒç«å“ã€å…¶ä»–ç«å“ï¼‰
    - è¯†åˆ«é‡å¤çš„æŒ‡æ ‡åˆ—ï¼ˆå¯è§å æ¯”ã€æ¨èå æ¯”ç­‰ï¼‰
    â†“
â‘£ Pythonæ‰§è¡Œå®½è¡¨â†’é•¿è¡¨è½¬æ¢
    - åŸºäºå“ç‰Œå—æ˜ å°„å±•å¼€
    - æ¯è¡Œå˜å¤šè¡Œï¼ˆå“ç‰Œæ•° Ã— åŸè¡Œæ•°ï¼‰
    â†“
â‘¤ å‰ç«¯å±•ç¤ºè½¬æ¢é¢„è§ˆ
    - æ˜¾ç¤ºåŸå§‹å®½è¡¨ç»´åº¦
    - æ˜¾ç¤ºè½¬æ¢åé•¿è¡¨ç»´åº¦
    - å±•ç¤ºå‰100è¡Œæ•°æ®ä¾›æ ¸å¯¹
    - æä¾›ä¸‹è½½åŠŸèƒ½
    â†“
â‘¥ åŸºäºé•¿è¡¨ç”Ÿæˆå…³é”®è¯æ’å
    - æŒ‰AIå¹³å°åˆ†ç»„
    - æŒ‰åˆ†æç»´åº¦åˆ†ç»„
    - æŒ‰å…³é”®è¯æ’åºç”Ÿæˆæ’åçŸ©é˜µ
    â†“
â‘¦ æå–å…¶ä»–æ•°æ®
    - å…ƒæ•°æ®
    - å“ç‰Œæ ¸å¿ƒæŒ‡æ ‡
    - AIå¹³å°æŒ‡æ ‡
    â†“
â‘§ è¿”å›å®Œæ•´åˆ†æç»“æœ
    â†“
â‘¨ å‰ç«¯æ¸²æŸ“å››å¤§æ¨¡å—
```

### 2.2 å…³é”®è¯æ•°æ®è½¬æ¢è¯¦è§£

#### 2.2.1 å®½è¡¨æ ¼å¼ç¤ºä¾‹ï¼ˆè½¬ç½®å‰ï¼‰

```
å…³é”®è¯          | AIå¹³å°    | ç§»å±±ç§‘æŠ€_å¯è§å æ¯” | ç§»å±±ç§‘æŠ€_æ¨èå æ¯” | ç§»å±±ç§‘æŠ€_Top1å æ¯” | æ€è¿ˆç‰¹_å¯è§å æ¯” | æ€è¿ˆç‰¹_æ¨èå æ¯” | ...
---------------|-----------|------------------|------------------|------------------|----------------|----------------|----
å›½å†…åšGEOæœ€å¥½   | DeepSeek  | 0                | 0                | 0                | 70             | 0              | ...
å›½å†…åšGEOæœ€å¥½   | Kimi      | 10               | 0                | 0                | 40             | 0              | ...
BIå·¥å…·æ¨è     | DeepSeek  | 30               | 20               | 10               | 50             | 30             | ...
```

**é—®é¢˜**ï¼š
- åˆ—å¤ªå¤šï¼ˆå“ç‰Œæ•° Ã— æŒ‡æ ‡æ•°ï¼‰
- ä¸æ˜“æŸ¥è¯¢å’Œèšåˆ
- éš¾ä»¥æŒ‰å“ç‰Œæˆ–æŒ‡æ ‡åˆ†ç»„

#### 2.2.2 é•¿è¡¨æ ¼å¼ï¼ˆè½¬ç½®åï¼‰

```
å…³é”®è¯          | AIå¹³å°    | å“ç‰Œ   | å“ç‰Œç±»å‹ | å¯è§å æ¯” | æ¨èå æ¯” | Top1å æ¯” | Top3å æ¯” | ...
---------------|-----------|--------|---------|---------|---------|---------|---------|----
å›½å†…åšGEOæœ€å¥½   | DeepSeek  | ç§»å±±ç§‘æŠ€ | å®¢æˆ·    | 0       | 0       | 0       | 0       | ...
å›½å†…åšGEOæœ€å¥½   | DeepSeek  | æ€è¿ˆç‰¹   | æ ¸å¿ƒç«å“ | 70      | 0       | 0       | 0       | ...
å›½å†…åšGEOæœ€å¥½   | Kimi      | ç§»å±±ç§‘æŠ€ | å®¢æˆ·    | 10      | 0       | 0       | 10      | ...
å›½å†…åšGEOæœ€å¥½   | Kimi      | æ€è¿ˆç‰¹   | æ ¸å¿ƒç«å“ | 40      | 0       | 30      | 40      | ...
BIå·¥å…·æ¨è     | DeepSeek  | ç§»å±±ç§‘æŠ€ | å®¢æˆ·    | 30      | 20      | 10      | 20      | ...
BIå·¥å…·æ¨è     | DeepSeek  | æ€è¿ˆç‰¹   | æ ¸å¿ƒç«å“ | 50      | 30      | 20      | 40      | ...
```

**ä¼˜åŠ¿**ï¼š
- âœ… æ ‡å‡†åŒ–è¡¨ç»“æ„
- âœ… æ˜“äºæŒ‰ä»»æ„ç»´åº¦åˆ†ç»„
- âœ… æ˜“äºæ’åºå’Œèšåˆ
- âœ… ä¾¿äºç”Ÿæˆå…³é”®è¯æ’åçŸ©é˜µ

---

## ğŸ¤– LLMæ™ºèƒ½å±‚è®¾è®¡

### 3.1 Schemaç»“æ„å®šä¹‰

#### 3.1.1 wide_tableç±»å‹Schema

```json
{
  "sheet_å…³é”®è¯æ•°æ®åˆ†æ": {
    "type": "wide_table",
    "header_row": 2,
    "data_start_row": 3,
    "base_columns": [
      {
        "excel_name": "å…³é”®è¯åç§°",
        "standard_name": "å…³é”®è¯",
        "col_index": 1
      },
      {
        "excel_name": "AIå¹³å°åç§°",
        "standard_name": "AIå¹³å°",
        "col_index": 2
      }
    ],
    "brand_blocks": [
      {
        "brand": "ç§»å±±ç§‘æŠ€",
        "brand_type": "å®¢æˆ·",
        "start_col": 3,
        "columns": [
          {
            "excel_name": "ç§»å±±ç§‘æŠ€(å®¢æˆ·)_AIå¹³å°çš„å¯è§å æ¯”",
            "standard_name": "å¯è§å æ¯”",
            "col_index": 3
          },
          {
            "excel_name": "ç§»å±±ç§‘æŠ€(å®¢æˆ·)_AIå¹³å°çš„æ¨èå æ¯”",
            "standard_name": "æ¨èå æ¯”",
            "col_index": 4
          },
          {
            "excel_name": "ç§»å±±ç§‘æŠ€(å®¢æˆ·)_AIå¹³å°ä¿¡æºå¹³å°å æ¯”",
            "standard_name": "ä¿¡æºå¹³å°å æ¯”",
            "col_index": 5
          },
          {
            "excel_name": "ç§»å±±ç§‘æŠ€(å®¢æˆ·)_AIå¹³å°ä¿¡æºæ–‡ç« å æ¯”",
            "standard_name": "ä¿¡æºæ–‡ç« å æ¯”",
            "col_index": 6
          },
          {
            "excel_name": "ç§»å±±ç§‘æŠ€(å®¢æˆ·)_AIå¹³å°Top1å æ¯”",
            "standard_name": "Top1å æ¯”",
            "col_index": 7
          },
          {
            "excel_name": "ç§»å±±ç§‘æŠ€(å®¢æˆ·)_AIå¹³å°Top3å æ¯”",
            "standard_name": "Top3å æ¯”",
            "col_index": 8
          },
          {
            "excel_name": "ç§»å±±ç§‘æŠ€(å®¢æˆ·)_AIå¹³å°Top5å æ¯”",
            "standard_name": "Top5å æ¯”",
            "col_index": 9
          },
          {
            "excel_name": "ç§»å±±ç§‘æŠ€(å®¢æˆ·)_AIå¹³å°çš„Top10å æ¯”",
            "standard_name": "Top10å æ¯”",
            "col_index": 10
          }
        ]
      },
      {
        "brand": "æ€è¿ˆç‰¹",
        "brand_type": "æ ¸å¿ƒç«å“",
        "start_col": 11,
        "columns": [
          // åŒæ ·çš„æŒ‡æ ‡ç»“æ„
        ]
      }
      // ... å…¶ä»–å“ç‰Œ
    ]
  }
}
```

### 3.2 LLM Promptè®¾è®¡

```python
def _build_prompt_for_wide_table(samples: Dict) -> str:
    """
    æ„å»ºè¯†åˆ«å®½è¡¨æ ¼å¼çš„Prompt
    """
    prompt = f"""
ä½ æ˜¯Excelæ•°æ®ç»“æ„åˆ†æä¸“å®¶ã€‚è¯·åˆ†æä»¥ä¸‹Excelæ–‡ä»¶ç»“æ„ï¼Œç‰¹åˆ«æ³¨æ„è¯†åˆ«**å®½è¡¨æ ¼å¼**ã€‚

=== Excelæ ·æœ¬æ•°æ® ===
{samples}

=== è¯†åˆ«ä»»åŠ¡ ===
1. è¯†åˆ«æ¯ä¸ªSheetçš„ç±»å‹ï¼š
   - metadata: å…ƒæ•°æ®ï¼ˆé”®å€¼å¯¹ï¼‰
   - table: æ ‡å‡†è¡¨æ ¼
   - wide_table: å®½è¡¨æ ¼å¼ï¼ˆå¤šå“ç‰Œåˆ—é‡å¤ï¼‰âš ï¸ é‡ç‚¹

2. å¯¹äºwide_tableç±»å‹ï¼Œéœ€è¦è¯†åˆ«ï¼š
   - base_columns: åŸºç¡€åˆ—ï¼ˆå¦‚ï¼šå…³é”®è¯ã€AIå¹³å°ï¼‰
   - brand_blocks: å“ç‰Œåˆ—å—
     * brand: å“ç‰Œåç§°
     * brand_type: å“ç‰Œç±»å‹ï¼ˆå®¢æˆ·/æ ¸å¿ƒç«å“/å…¶ä»–ç«å“ï¼‰
     * columns: è¯¥å“ç‰Œçš„é‡å¤æŒ‡æ ‡åˆ—
       - å¯è§å æ¯”ã€æ¨èå æ¯”ã€ä¿¡æºå¹³å°å æ¯”ã€ä¿¡æºæ–‡ç« å æ¯”
       - Top1å æ¯”ã€Top3å æ¯”ã€Top5å æ¯”ã€Top10å æ¯”

3. **å®½è¡¨ç‰¹å¾è¯†åˆ«**ï¼š
   - è¡¨å¤´æœ‰å¤šä¸ªå“ç‰Œåç§°ï¼ˆå¦‚ï¼šç§»å±±ç§‘æŠ€ã€æ€è¿ˆç‰¹ã€å¸†è½¯ï¼‰
   - æ¯ä¸ªå“ç‰Œä¸‹æœ‰ç›¸åŒçš„æŒ‡æ ‡åˆ—
   - åˆ—åå¯èƒ½åŒ…å«å“ç‰Œåç§°å‰ç¼€
   - åˆå¹¶å•å…ƒæ ¼æ ‡è¯†å“ç‰Œå—

=== è¾“å‡ºæ ¼å¼ ===
{{
  "file_info": {{
    "total_sheets": æ•°é‡,
    "identified_sheets": [sheetåç§°åˆ—è¡¨]
  }},
  "sheet_å…³é”®è¯æ•°æ®åˆ†æ": {{
    "type": "wide_table",
    "header_row": è¡¨å¤´è¡Œå·,
    "data_start_row": æ•°æ®èµ·å§‹è¡Œ,
    "base_columns": [...],
    "brand_blocks": [
      {{
        "brand": "å“ç‰Œå",
        "brand_type": "å®¢æˆ·|æ ¸å¿ƒç«å“|å…¶ä»–ç«å“",
        "start_col": èµ·å§‹åˆ—å·,
        "columns": [...]
      }}
    ]
  }}
}}

è¯·åªè¾“å‡ºJSONï¼Œä¸è¦æ·»åŠ ä»»ä½•è§£é‡Šæ–‡å­—ã€‚
"""
    return prompt
```

---

## ğŸ æ•°æ®å¤„ç†å±‚å®ç°

### 4.1 å®½è¡¨è½¬é•¿è¡¨æ ¸å¿ƒç®—æ³•

```python
class ExcelDataProcessor:
    
    def _transform_wide_to_long(
        self, 
        sheet_name: str, 
        sheet_schema: Dict
    ) -> pd.DataFrame:
        """
        å°†å®½è¡¨è½¬æ¢ä¸ºé•¿è¡¨
        
        ç®—æ³•æ­¥éª¤ï¼š
        1. è¯»å–åŸå§‹å®½è¡¨
        2. æå–åŸºç¡€åˆ—ï¼ˆå…³é”®è¯ã€AIå¹³å°ï¼‰
        3. éå†æ¯ä¸ªå“ç‰Œå—
        4. å±•å¼€ï¼šæ¯è¡Œ â†’ Nè¡Œï¼ˆN=å“ç‰Œæ•°ï¼‰
        5. åˆå¹¶ä¸ºé•¿è¡¨
        
        å‚æ•°:
            sheet_name: Sheetåç§°
            sheet_schema: åŒ…å«brand_blocksçš„Schema
            
        è¿”å›:
            DataFrame: é•¿è¡¨æ ¼å¼
        """
        try:
            header_row = sheet_schema.get('header_row', 1) - 1
            df_wide = pd.read_excel(
                self.excel_file_path, 
                sheet_name=sheet_name, 
                header=header_row
            )
            
            print(f"åŸå§‹å®½è¡¨ç»´åº¦: {df_wide.shape}")
            
            # 1. æå–åŸºç¡€åˆ—
            base_columns = sheet_schema.get('base_columns', [])
            base_col_names = [col['excel_name'] for col in base_columns]
            base_df = df_wide[base_col_names].copy()
            
            # 2. å‡†å¤‡é•¿è¡¨ç»“æ„
            long_records = []
            
            # 3. éå†æ¯ä¸€è¡Œ
            for idx, row in df_wide.iterrows():
                # æå–åŸºç¡€ä¿¡æ¯
                base_info = {
                    col['standard_name']: row[col['excel_name']]
                    for col in base_columns
                }
                
                # 4. éå†æ¯ä¸ªå“ç‰Œå—
                brand_blocks = sheet_schema.get('brand_blocks', [])
                for brand_block in brand_blocks:
                    record = base_info.copy()
                    record['å“ç‰Œ'] = brand_block['brand']
                    record['å“ç‰Œç±»å‹'] = brand_block['brand_type']
                    
                    # æå–è¯¥å“ç‰Œçš„æ‰€æœ‰æŒ‡æ ‡å€¼
                    for col_info in brand_block['columns']:
                        excel_col_name = col_info['excel_name']
                        standard_name = col_info['standard_name']
                        
                        if excel_col_name in df_wide.columns:
                            value = row[excel_col_name]
                            record[standard_name] = value
                        else:
                            record[standard_name] = None
                    
                    long_records.append(record)
            
            # 5. ç”Ÿæˆé•¿è¡¨DataFrame
            df_long = pd.DataFrame(long_records)
            
            # 6. æ•°æ®æ¸…æ´—
            df_long = self._clean_dataframe(df_long)
            
            print(f"è½¬æ¢åé•¿è¡¨ç»´åº¦: {df_long.shape}")
            print(f"é•¿è¡¨åˆ—å: {list(df_long.columns)}")
            
            return df_long
            
        except Exception as e:
            print(f"å®½è¡¨è½¬é•¿è¡¨å¤±è´¥: {e}")
            import traceback
            traceback.print_exc()
            return pd.DataFrame()
```

### 4.2 åŸºäºé•¿è¡¨ç”Ÿæˆå…³é”®è¯æ’å

```python
def _extract_keyword_ranking_from_long_table(
    self, 
    df_long: pd.DataFrame
) -> Dict:
    """
    ä»é•¿è¡¨ç”Ÿæˆå…³é”®è¯æ’åçŸ©é˜µ
    
    è¾“å‡ºç»“æ„:
    {
        "DeepSeek": {
            "å¯è§å æ¯”": {
                "å…³é”®è¯A": {
                    "æ’å1": {"å“ç‰Œ": "æ€è¿ˆç‰¹", "æ•°å€¼": 70},
                    "æ’å2": {"å“ç‰Œ": "ç§»å±±ç§‘æŠ€", "æ•°å€¼": 10}
                },
                "å…³é”®è¯B": {...}
            },
            "æ¨èå æ¯”": {...}
        },
        "Kimi": {...}
    }
    """
    try:
        keyword_data = {}
        
        # åˆ†æç»´åº¦åˆ—è¡¨
        dimensions = [
            'å¯è§å æ¯”', 'æ¨èå æ¯”', 
            'ä¿¡æºå¹³å°å æ¯”', 'ä¿¡æºæ–‡ç« å æ¯”',
            'Top1å æ¯”', 'Top3å æ¯”', 'Top5å æ¯”', 'Top10å æ¯”'
        ]
        
        # 1. æŒ‰AIå¹³å°åˆ†ç»„
        for platform in df_long['AIå¹³å°'].unique():
            if pd.isna(platform):
                continue
            
            platform_df = df_long[df_long['AIå¹³å°'] == platform]
            platform_data = {}
            
            # 2. æŒ‰åˆ†æç»´åº¦åˆ†ç»„
            for dimension in dimensions:
                if dimension not in df_long.columns:
                    continue
                
                dimension_data = {}
                
                # 3. æŒ‰å…³é”®è¯åˆ†ç»„
                for keyword in platform_df['å…³é”®è¯'].unique():
                    if pd.isna(keyword):
                        continue
                    
                    keyword_df = platform_df[
                        platform_df['å…³é”®è¯'] == keyword
                    ]
                    
                    # 4. æŒ‰å½“å‰ç»´åº¦å€¼æ’åº
                    sorted_df = keyword_df.sort_values(
                        by=dimension, 
                        ascending=False,
                        na_position='last'
                    )
                    
                    # 5. ç”Ÿæˆæ’åå­—å…¸
                    rankings = {}
                    for rank, (_, row) in enumerate(sorted_df.iterrows(), 1):
                        value = row[dimension]
                        if pd.notna(value) and value > 0:
                            rankings[f'æ’å{rank}'] = {
                                'å“ç‰Œ': str(row['å“ç‰Œ']),
                                'æ•°å€¼': float(value)
                            }
                    
                    if rankings:  # åªä¿å­˜éç©ºæ’å
                        dimension_data[str(keyword)] = rankings
                
                if dimension_data:
                    platform_data[dimension] = dimension_data
            
            if platform_data:
                keyword_data[str(platform)] = platform_data
        
        print(f"ç”Ÿæˆå…³é”®è¯æ’å: {len(keyword_data)} ä¸ªå¹³å°")
        return keyword_data
        
    except Exception as e:
        print(f"ç”Ÿæˆå…³é”®è¯æ’åå¤±è´¥: {e}")
        import traceback
        traceback.print_exc()
        return {}
```

### 4.3 ä¿®æ”¹åçš„process()æ–¹æ³•

```python
def process(self) -> Dict:
    """
    ä¸»å¤„ç†æµç¨‹ï¼ˆå¢åŠ å®½è¡¨è½¬æ¢ï¼‰
    """
    result = {
        'metadata': {},
        'brand_metrics': {},
        'platform_metrics': {},
        'keyword_analysis': {},
        'long_table_preview': None  # æ–°å¢ï¼šé•¿è¡¨é¢„è§ˆ
    }
    
    try:
        # 1. æå–å…ƒæ•°æ®
        result['metadata'] = self._extract_metadata()
        
        # 2. æå–å“ç‰Œæ ¸å¿ƒæŒ‡æ ‡
        result['brand_metrics'] = self._extract_brand_metrics()
        
        # 3. æå–AIå¹³å°æŒ‡æ ‡
        result['platform_metrics'] = self._extract_platform_metrics()
        
        # 4. æå–å…³é”®è¯åˆ†æï¼ˆæ–°æµç¨‹ï¼‰
        keyword_sheet_schema = self._find_keyword_sheet()
        
        if keyword_sheet_schema:
            sheet_name = keyword_sheet_schema['name']
            schema = keyword_sheet_schema['schema']
            
            # æ£€æŸ¥æ˜¯å¦ä¸ºå®½è¡¨
            if schema.get('type') == 'wide_table':
                print("æ£€æµ‹åˆ°å®½è¡¨æ ¼å¼ï¼Œæ‰§è¡Œè½¬æ¢...")
                
                # 4.1 å®½è¡¨â†’é•¿è¡¨è½¬æ¢
                df_long = self._transform_wide_to_long(sheet_name, schema)
                
                # 4.2 ç”Ÿæˆé•¿è¡¨é¢„è§ˆï¼ˆå‰100è¡Œï¼‰
                result['long_table_preview'] = {
                    'shape': df_long.shape,
                    'columns': list(df_long.columns),
                    'data': df_long.head(100).to_dict('records')
                }
                
                # 4.3 åŸºäºé•¿è¡¨ç”Ÿæˆå…³é”®è¯æ’å
                result['keyword_analysis'] = \
                    self._extract_keyword_ranking_from_long_table(df_long)
            
            else:
                # æ ‡å‡†è¡¨æ ¼å¤„ç†
                result['keyword_analysis'] = \
                    self._extract_keyword_from_sheet(sheet_name, schema)
        
        return result
        
    except Exception as e:
        print(f"æ•°æ®å¤„ç†å¤±è´¥: {e}")
        import traceback
        traceback.print_exc()
        return result
```

---

## ğŸ¨ å‰ç«¯è®¾è®¡

### 5.1 æ•°æ®è½¬æ¢é¢„è§ˆæ¨¡å—

#### 5.1.1 HTMLç»“æ„

```html
<!-- æ•°æ®è½¬æ¢é¢„è§ˆåŒºåŸŸï¼ˆä½äºæ•°æ®å°é¢å’Œåˆ†æç»“æœä¹‹é—´ï¼‰ -->
<div id="dataTransformSection" class="section-card" style="display: none;">
    <h2 class="section-title">
        ğŸ“‹ æ•°æ®è½¬æ¢é¢„è§ˆ
        <span class="transform-badge">å®½è¡¨â†’é•¿è¡¨</span>
    </h2>
    
    <div class="transform-stats">
        <div class="stat-item">
            <div class="stat-label">åŸå§‹å®½è¡¨</div>
            <div class="stat-value" id="wideTableDim">-</div>
        </div>
        <div class="stat-arrow">â†’</div>
        <div class="stat-item">
            <div class="stat-label">è½¬æ¢åé•¿è¡¨</div>
            <div class="stat-value" id="longTableDim">-</div>
        </div>
    </div>
    
    <div class="transform-actions">
        <button id="downloadLongTableBtn" class="btn-secondary">
            <svg><!-- download icon --></svg>
            ä¸‹è½½é•¿è¡¨æ•°æ®
        </button>
        <button id="togglePreviewBtn" class="btn-text">
            <span id="togglePreviewText">æ˜¾ç¤ºè¯¦ç»†æ•°æ®</span>
            <svg><!-- chevron icon --></svg>
        </button>
    </div>
    
    <div id="longTablePreview" class="table-container" style="display: none;">
        <!-- æ˜¾ç¤ºè½¬æ¢åçš„é•¿è¡¨æ•°æ® -->
    </div>
</div>
```

#### 5.1.2 JavaScriptå®ç°

```javascript
// æ¸²æŸ“æ•°æ®è½¬æ¢é¢„è§ˆ
function renderDataTransformPreview() {
    const preview = appState.analysisData.long_table_preview;
    
    if (!preview || !preview.data || preview.data.length === 0) {
        elements.dataTransformSection.style.display = 'none';
        return;
    }
    
    // æ˜¾ç¤ºè½¬æ¢é¢„è§ˆåŒºåŸŸ
    elements.dataTransformSection.style.display = 'block';
    
    // æ›´æ–°ç»´åº¦ç»Ÿè®¡
    // å‡è®¾åŸå§‹å®½è¡¨æœ‰ Nè¡Œ Ã— Måˆ—ï¼Œè½¬æ¢åæœ‰ NÃ—å“ç‰Œæ•° è¡Œ Ã— æ ‡å‡†åˆ—æ•°
    const [longRows, longCols] = preview.shape;
    const brands = new Set(preview.data.map(row => row['å“ç‰Œ'])).size;
    const wideRows = Math.floor(longRows / brands);
    
    document.getElementById('wideTableDim').textContent = 
        `${wideRows} è¡Œ Ã— ${longCols * brands} åˆ—`;
    document.getElementById('longTableDim').textContent = 
        `${longRows} è¡Œ Ã— ${longCols} åˆ—`;
    
    // æ¸²æŸ“é•¿è¡¨é¢„è§ˆ
    renderLongTableData(preview);
}

// æ¸²æŸ“é•¿è¡¨æ•°æ®
function renderLongTableData(preview) {
    const container = document.getElementById('longTablePreview');
    
    // ç”Ÿæˆè¡¨æ ¼HTML
    let html = '<table><thead><tr>';
    
    // è¡¨å¤´
    preview.columns.forEach(col => {
        html += `<th>${col}</th>`;
    });
    html += '</tr></thead><tbody>';
    
    // æ•°æ®è¡Œï¼ˆå‰100è¡Œï¼‰
    preview.data.forEach(row => {
        html += '<tr>';
        preview.columns.forEach(col => {
            let value = row[col];
            
            // æ ¼å¼åŒ–æ•°å€¼
            if (typeof value === 'number') {
                const percentCols = ['å¯è§å æ¯”', 'æ¨èå æ¯”', 'Top1å æ¯”', 
                                    'Top3å æ¯”', 'Top5å æ¯”', 'Top10å æ¯”'];
                if (percentCols.includes(col)) {
                    value = `${value.toFixed(1)}%`;
                } else {
                    value = value.toLocaleString();
                }
            } else if (value === null || value === undefined) {
                value = '-';
            }
            
            html += `<td>${value}</td>`;
        });
        html += '</tr>';
    });
    
    html += '</tbody></table>';
    
    container.innerHTML = html;
}

// ä¸‹è½½é•¿è¡¨æ•°æ®
function downloadLongTableData() {
    const preview = appState.analysisData.long_table_preview;
    if (!preview) return;
    
    // è½¬æ¢ä¸ºCSV
    const csv = convertToCSV(preview);
    
    // åˆ›å»ºä¸‹è½½é“¾æ¥
    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = 'å…³é”®è¯æ•°æ®_é•¿è¡¨æ ¼å¼.csv';
    link.click();
}

// CSVè½¬æ¢è¾…åŠ©å‡½æ•°
function convertToCSV(preview) {
    let csv = preview.columns.join(',') + '\n';
    
    preview.data.forEach(row => {
        const values = preview.columns.map(col => {
            let value = row[col];
            if (value === null || value === undefined) value = '';
            // è½¬ä¹‰é€—å·å’Œå¼•å·
            if (typeof value === 'string' && value.includes(',')) {
                value = `"${value.replace(/"/g, '""')}"`;
            }
            return value;
        });
        csv += values.join(',') + '\n';
    });
    
    return csv;
}

// ç»‘å®šäº‹ä»¶
elements.downloadLongTableBtn.addEventListener('click', downloadLongTableData);
elements.togglePreviewBtn.addEventListener('click', () => {
    const preview = document.getElementById('longTablePreview');
    const text = document.getElementById('togglePreviewText');
    
    if (preview.style.display === 'none') {
        preview.style.display = 'block';
        text.textContent = 'éšè—è¯¦ç»†æ•°æ®';
    } else {
        preview.style.display = 'none';
        text.textContent = 'æ˜¾ç¤ºè¯¦ç»†æ•°æ®';
    }
});
```

### 5.2 CSSæ ·å¼

```css
/* æ•°æ®è½¬æ¢é¢„è§ˆåŒºåŸŸ */
.transform-badge {
    display: inline-block;
    padding: 4px 12px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 12px;
    font-size: 12px;
    font-weight: 600;
    margin-left: 12px;
}

.transform-stats {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 24px;
    padding: 24px;
    background: #f8f9fa;
    border-radius: 8px;
    margin-bottom: 20px;
}

.stat-item {
    text-align: center;
}

.stat-label {
    font-size: 13px;
    color: #6c757d;
    margin-bottom: 8px;
}

.stat-value {
    font-size: 20px;
    font-weight: 600;
    color: #495057;
}

.stat-arrow {
    font-size: 24px;
    color: #667eea;
    font-weight: bold;
}

.transform-actions {
    display: flex;
    gap: 12px;
    margin-bottom: 16px;
}

.btn-secondary {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 8px 16px;
    background: white;
    border: 1px solid #dee2e6;
    border-radius: 6px;
    color: #495057;
    cursor: pointer;
    transition: all 0.2s;
}

.btn-secondary:hover {
    background: #f8f9fa;
    border-color: #adb5bd;
}

.btn-text {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    background: none;
    border: none;
    color: #667eea;
    cursor: pointer;
    font-size: 14px;
}
```

---

## ğŸ§ª APIè®¾è®¡

### 6.1 åˆ†ææ¥å£ï¼ˆä¿®æ”¹ï¼‰

**POST /api/analyze**

è¯·æ±‚ï¼š
```
Content-Type: multipart/form-data
file: Excelæ–‡ä»¶
```

å“åº”ï¼š
```json
{
  "status": "success",
  "message": "åˆ†æå®Œæˆ",
  "data": {
    "metadata": { ... },
    "brand_metrics": { ... },
    "platform_metrics": { ... },
    "keyword_analysis": { ... },
    "long_table_preview": {
      "shape": [320, 12],
      "columns": [
        "å…³é”®è¯", "AIå¹³å°", "å“ç‰Œ", "å“ç‰Œç±»å‹",
        "å¯è§å æ¯”", "æ¨èå æ¯”", "ä¿¡æºå¹³å°å æ¯”", "ä¿¡æºæ–‡ç« å æ¯”",
        "Top1å æ¯”", "Top3å æ¯”", "Top5å æ¯”", "Top10å æ¯”"
      ],
      "data": [
        {
          "å…³é”®è¯": "å›½å†…åšGEOæœ€å¥½çš„å…¬å¸",
          "AIå¹³å°": "DeepSeek",
          "å“ç‰Œ": "ç§»å±±ç§‘æŠ€",
          "å“ç‰Œç±»å‹": "å®¢æˆ·",
          "å¯è§å æ¯”": 0,
          "æ¨èå æ¯”": 0,
          ...
        },
        // ... æœ€å¤š100è¡Œ
      ]
    }
  },
  "processing_time": 18.5,
  "timestamp": "2024-10-19T18:30:00"
}
```

---

## âœ… æµ‹è¯•ç­–ç•¥

### 7.1 å•å…ƒæµ‹è¯•

```python
# tests/test_wide_table_transform.py

def test_wide_table_detection():
    """æµ‹è¯•å®½è¡¨æ ¼å¼æ£€æµ‹"""
    schema = llm_analyzer.analyze_excel_structure('wide_table.xlsx')
    assert schema['sheet_å…³é”®è¯æ•°æ®åˆ†æ']['type'] == 'wide_table'
    assert 'brand_blocks' in schema['sheet_å…³é”®è¯æ•°æ®åˆ†æ']

def test_wide_to_long_transform():
    """æµ‹è¯•å®½è¡¨è½¬é•¿è¡¨"""
    df_long = processor._transform_wide_to_long('å…³é”®è¯æ•°æ®åˆ†æ', schema)
    
    # éªŒè¯ç»´åº¦
    assert 'å“ç‰Œ' in df_long.columns
    assert 'å“ç‰Œç±»å‹' in df_long.columns
    assert 'å¯è§å æ¯”' in df_long.columns
    
    # éªŒè¯æ•°æ®å®Œæ•´æ€§
    brands = df_long['å“ç‰Œ'].unique()
    assert len(brands) >= 2  # è‡³å°‘æœ‰å®¢æˆ·å’Œç«å“

def test_keyword_ranking_generation():
    """æµ‹è¯•å…³é”®è¯æ’åç”Ÿæˆ"""
    result = processor._extract_keyword_ranking_from_long_table(df_long)
    
    assert len(result) > 0
    assert 'DeepSeek' in result
    assert 'å¯è§å æ¯”' in result['DeepSeek']
```

### 7.2 é›†æˆæµ‹è¯•

```python
def test_end_to_end_wide_table_processing():
    """ç«¯åˆ°ç«¯æµ‹è¯•ï¼šå®½è¡¨ä¸Šä¼ åˆ°å‰ç«¯å±•ç¤º"""
    # 1. ä¸Šä¼ æ–‡ä»¶
    response = client.post('/api/analyze', 
                          data={'file': wide_table_excel})
    
    # 2. éªŒè¯å“åº”
    assert response.status_code == 200
    data = response.json()['data']
    
    # 3. éªŒè¯é•¿è¡¨é¢„è§ˆ
    assert 'long_table_preview' in data
    preview = data['long_table_preview']
    assert preview['shape'][0] > 0  # æœ‰æ•°æ®è¡Œ
    assert 'å“ç‰Œ' in preview['columns']
    
    # 4. éªŒè¯å…³é”®è¯æ’å
    assert len(data['keyword_analysis']) > 0
    platform_data = data['keyword_analysis']['DeepSeek']
    assert 'å¯è§å æ¯”' in platform_data
```

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### 8.1 ä¼˜åŒ–ç­–ç•¥

1. **LLMè°ƒç”¨ä¼˜åŒ–**
   - ç¼“å­˜Schemaç»“æœï¼ˆç›¸åŒç»“æ„çš„Excelï¼‰
   - åªåœ¨é¦–æ¬¡ä¸Šä¼ æ—¶è°ƒç”¨LLM
   - è¶…æ—¶é‡è¯•æœºåˆ¶

2. **æ•°æ®å¤„ç†ä¼˜åŒ–**
   - pandaså‘é‡åŒ–æ“ä½œ
   - åˆ†å—å¤„ç†å¤§æ–‡ä»¶
   - å¹¶è¡Œå¤„ç†å¤šä¸ªå“ç‰Œå—

3. **å‰ç«¯ä¼˜åŒ–**
   - è™šæ‹Ÿæ»šåŠ¨ï¼ˆå¤§æ•°æ®è¡¨æ ¼ï¼‰
   - åˆ†é¡µåŠ è½½è½¬æ¢é¢„è§ˆ
   - æ‡’åŠ è½½å›¾è¡¨

### 8.2 æ€§èƒ½æŒ‡æ ‡

| æ“ä½œ | ç›®æ ‡æ—¶é—´ | è¯´æ˜ |
|-----|---------|------|
| LLMè¯†åˆ« | < 5s | é¦–æ¬¡è¯†åˆ« |
| å®½è¡¨è½¬æ¢ | < 3s | 100è¡ŒÃ—10å“ç‰Œ |
| å…³é”®è¯æ’å | < 2s | 500æ¡æ•°æ® |
| æ€»å¤„ç†æ—¶é—´ | < 15s | ç«¯åˆ°ç«¯ |

---

## ğŸ”’ å®‰å…¨ä¸åˆè§„

### 9.1 æ•°æ®å®‰å…¨

1. **æ–‡ä»¶å¤„ç†**
   - ä¸Šä¼ æ–‡ä»¶ä¸´æ—¶å­˜å‚¨
   - å¤„ç†å®Œæˆåç«‹å³åˆ é™¤
   - ä¸æŒä¹…åŒ–æ•æ„Ÿæ•°æ®

2. **APIå®‰å…¨**
   - æ–‡ä»¶å¤§å°é™åˆ¶ï¼ˆ50MBï¼‰
   - æ–‡ä»¶ç±»å‹éªŒè¯
   - è¯·æ±‚é¢‘ç‡é™åˆ¶

3. **æ•°æ®è„±æ•**
   - å¯¼å‡ºæ—¶æ”¯æŒè„±æ•é€‰é¡¹
   - æ—¥å¿—ä¸è®°å½•æ•æ„Ÿå­—æ®µ

---

## ğŸ“ é”™è¯¯å¤„ç†

### 10.1 å¸¸è§é”™è¯¯åœºæ™¯

| é”™è¯¯åœºæ™¯ | é”™è¯¯ç  | å¤„ç†æ–¹å¼ |
|---------|--------|---------|
| æ— æ³•è¯†åˆ«å“ç‰Œå— | E001 | æç¤ºç”¨æˆ·æ£€æŸ¥Excelæ ¼å¼ |
| è½¬æ¢åæ•°æ®ä¸ºç©º | E002 | é™çº§ä¸ºæ ‡å‡†è¡¨å¤„ç† |
| LLMè¶…æ—¶ | E003 | ä½¿ç”¨åŸºç¡€Schemaé‡è¯• |
| å†…å­˜ä¸è¶³ | E004 | åˆ†å—å¤„ç†æˆ–æç¤ºå‡å°æ–‡ä»¶ |

### 10.2 é™çº§ç­–ç•¥

```python
def process_with_fallback(self):
    """
    å¸¦é™çº§ç­–ç•¥çš„å¤„ç†æµç¨‹
    """
    try:
        # å°è¯•LLMè¯†åˆ«
        schema = self.llm_analyzer.analyze_excel_structure(file)
    except Exception as e:
        print(f"LLMè¯†åˆ«å¤±è´¥: {e}, ä½¿ç”¨åŸºç¡€Schema")
        schema = self._create_basic_schema()
    
    try:
        # å°è¯•å®½è¡¨è½¬æ¢
        if schema.get('type') == 'wide_table':
            df_long = self._transform_wide_to_long(...)
    except Exception as e:
        print(f"å®½è¡¨è½¬æ¢å¤±è´¥: {e}, å°è¯•æ ‡å‡†è¡¨å¤„ç†")
        df_long = self._read_as_standard_table(...)
    
    return result
```

---

## ğŸš€ éƒ¨ç½²æ–¹æ¡ˆ

### 11.1 ç¯å¢ƒè¦æ±‚

```yaml
# requirements.txt (æ›´æ–°)
flask==2.3.0
pandas>=2.2.0
openpyxl==3.1.2
requests==2.31.0
python-dotenv==1.0.0
gunicorn==21.2.0

# æ–°å¢
numpy>=1.24.0
xlrd==2.0.1  # å…¼å®¹è€ç‰ˆæœ¬Excel
```

### 11.2 Dockeré…ç½®

```dockerfile
FROM python:3.11-slim

WORKDIR /app

# å®‰è£…ä¾èµ–
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# å¤åˆ¶ä»£ç 
COPY backend/ ./backend/
COPY config/ ./config/
COPY frontend/ ./frontend/

# ç¯å¢ƒå˜é‡
ENV FLASK_APP=backend/app.py
ENV FLASK_ENV=production
ENV PORT=5001

# å¯åŠ¨å‘½ä»¤
CMD ["gunicorn", "-b", "0.0.0.0:5001", "-w", "4", "backend.app:app"]
```

---

## ğŸ“š é™„å½•

### A. å­—æ®µæ˜ å°„é…ç½®

```json
{
  "field_synonyms": {
    "å…³é”®è¯": ["å…³é”®è¯", "å…³é”®è¯åç§°", "keyword"],
    "AIå¹³å°": ["AIå¹³å°", "AIå¹³å°åç§°", "å¹³å°", "platform"],
    "å“ç‰Œ": ["å“ç‰Œ", "å“ç‰Œåç§°", "brand"],
    "å¯è§å æ¯”": ["å¯è§å æ¯”", "å¯è§æ¦‚ç‡", "AIå¹³å°çš„å¯è§å æ¯”"],
    "æ¨èå æ¯”": ["æ¨èå æ¯”", "æ¨èæ¦‚ç‡", "AIå¹³å°çš„æ¨èå æ¯”"],
    "Top1å æ¯”": ["Top1å æ¯”", "AIå¹³å°Top1å æ¯”"],
    "Top3å æ¯”": ["Top3å æ¯”", "Topå‰3å æ¯”", "AIå¹³å°Top3å æ¯”"],
    "Top5å æ¯”": ["Top5å æ¯”", "Topå‰5å æ¯”", "AIå¹³å°Top5å æ¯”"],
    "Top10å æ¯”": ["Top10å æ¯”", "AIå¹³å°çš„Top10å æ¯”"]
  }
}
```

### B. ç¤ºä¾‹æ•°æ®æ–‡ä»¶

å‚è€ƒæ–‡ä»¶ï¼š
- `å¾…å¤„ç†æ•°æ®_å‰¯æœ¬/å–3sheetå‚è€ƒæ ·ä¾‹.xlsx` - å®½è¡¨ç¤ºä¾‹
- `å¾…å¤„ç†æ•°æ®_å‰¯æœ¬/å–3sheet2025105æ€è¿ˆç‰¹.xlsx` - å®é™…æ•°æ®

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒï¼š
1. [README.md](../README.md) - å¿«é€Ÿå¼€å§‹æŒ‡å—
2. [æµ‹è¯•ç”¨ä¾‹æ–‡æ¡£](./æµ‹è¯•ç”¨ä¾‹_V2.0.md) - è¯¦ç»†æµ‹è¯•åœºæ™¯
3. [æ•…éšœæ’æŸ¥æŒ‡å—](./troubleshooting.md) - å¸¸è§é—®é¢˜è§£å†³

---

**æ–‡æ¡£ç‰ˆæœ¬**: V4.0  
**æœ€åæ›´æ–°**: 2024-10-19  
**ä½œè€…**: AIå¼€å‘å›¢é˜Ÿ

